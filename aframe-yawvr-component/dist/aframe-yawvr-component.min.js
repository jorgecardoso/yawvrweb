!function(e,n){if("object"==typeof exports&&"object"==typeof module)module.exports=n();else if("function"==typeof define&&define.amd)define([],n);else{var o=n();for(var t in o)("object"==typeof exports?exports:e)[t]=o[t]}}(this,(()=>(()=>{if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");function e(e,n,o){return new Promise(((t,i)=>{console.log("Stopping app: ",o),fetch(e+"/stop/",{keepalive:!0}).then((function(e){return e.json()})).then((function(c){"STOP"==c.commandreceived?(console.log("Stopped"),t([e,n,o])):(console.log("Could not stop",c),i(c))})).catch((function(e){console.log(e),i(error)}))}))}return AFRAME.registerComponent("yawvr",{schema:{appname:{type:"string",default:"myApp"},framerate:{type:"number",default:1}},multiple:!1,init:function(){this._ready=!1,this._lastT=0;let e=this;this._registeredEventsPromise=new Promise((function(e,n){let o=2;console.log("Using Service Discovery: https://hmd-link-service.glitch.me/"),setTimeout((function t(){fetch("https://hmd-link-service.glitch.me/").then((function(e){return e.json()})).then((function(n){n.yawmiddleware?(console.log("Yaw Middleware found through service discovery: ",n.yawmiddleware),e(n.yawmiddleware.address)):(o=Math.min(2*o,30),console.log("Yaw Middleware not found through service discovery. Trying again in ",o," seconds."),setTimeout(t,1e3*o))})).catch((function(e){console.log(e),n(e)}))}),o)})).then((function(n){return e._middlewareAddress=n,function(e,n){return new Promise((function(o,t){console.log("Asking Yaw Middleware: ",e," for existing simulators.");let i=2;setTimeout((function c(){fetch(e+"/simulators").then((function(e){return e.json()})).then((function(t){let r=null;t.length>0&&(console.log("Found simulators: ",t),t.forEach((e=>{e.simulatorName.match(n)&&(console.log("Found simulator matching '",n,"': ",e),r=e)}))),r?o([e,r]):(i=Math.min(2*i,30),console.log("No simulators found through middleware. Asking again in ",i," seconds."),setTimeout(c,1e3*i))})).catch((function(e){console.log(e),t(e)}))}),i)}))}(n,/.*/)})).then((function([e,n]){return function(e,n){return new Promise(((o,t)=>{console.log("Connecting to: "+n.simulatorId),fetch(e+"/connect/"+n.simulatorId).then((function(e){return e.json()})).then((function(t){console.log("Connected to: "+n.simulatorId),o([e,n])})).catch((e=>{console.log(e),t(e)}))}))}(e,n)})).then((function([n,o]){return function(e,n,o){return new Promise(((t,i)=>{let c=o+crypto.randomUUID(),r=!1;console.log("Checking in app: ",c),fetch(e+"/checkin/"+c).then((function(e){return e.json()})).then((function(o){"AVAILABLE"==o.devicestatus&&(r=!0),r?(console.log("Checked in: ",o),t([e,n,c])):(console.log("Could not check in: ",o),i(o))})).catch((function(e){console.log(e),i(error)}))}))}(n,o,e.data.appname)})).then((function([e,n,o]){return function(e,n,o){return console.log("Registering unload event."),window.onbeforeunload=function(n){console.log("Unloading window"),fetch(e+"/stop/",{keepalive:!0}).then((function(e){return e.json()})).then((function(e){console.log(e)})).catch((function(e){console.log(e)})),fetch(e+"/exit/",{keepalive:!0}).then((function(e){return e.json()})).then((function(e){console.log(e)})).catch((function(e){console.log(e)}))},console.log(window.onbeforeunload),Promise.resolve([e,n,o])}(e,n,o)})).catch((e=>(console.log("Init: ",e),Promise.reject(e))))},update:function(e){this._interval=1e3/this.data.framerate},remove:function(){let n=this;this._registeredEventsPromise.then((function([o,t,i]){n.ready=!1,e(o,t,i),function(e,n,o){new Promise(((t,i)=>{console.log("Exiting app: ",o),fetch(e+"/exit/",{keepalive:!0}).then((function(e){return e.json()})).then((function(c){"EXIT"==c.commandreceived?(console.log("Exited"),t([e,n,o])):(console.log("Could not exit",c),i(c))})).catch((function(e){console.log(e),i(error)}))}))}(o,t,i)})).catch((e=>{console.log(e)}))},tick:function(e){if(this._ready&&e-this._lastT>=this._interval){let n=THREE.MathUtils.radToDeg(this.el.object3D.rotation.y),o=THREE.MathUtils.radToDeg(this.el.object3D.rotation.x),t=THREE.MathUtils.radToDeg(this.el.object3D.rotation.z);fetch(this._middlewareAddress+"/SET_POSITION/"+n+"/"+o+"/"+t),this._lastT=e}},pause:function(){let n=this;this._registeredEventsPromise.then((function([n,o,t]){return e(n,o,t)})).then((function([e,o,t]){n._ready=!1})).catch((e=>{console.log(e)}))},play:function(){let e=this;this._registeredEventsPromise.then((function([e,n,o]){return function(e,n,o){return new Promise(((t,i)=>{console.log("Starting app: ",o),fetch(e+"/start/").then((function(e){return e.json()})).then((function(c){"START"==c.commandreceived?(console.log("Started"),t([e,n,o])):(console.log("Could not start",c),i(c))})).catch((function(e){console.log(e),i(error)}))}))}(e,n,o)})).then((function([n,o,t]){e._ready=!0})).catch((e=>{console.log("Play: ",e)}))}}),{}})()));